name: Unit Tests
on:
  workflow_dispatch:
  push:
    branches:
      - master
      - main
jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout tests repository
        uses: actions/checkout@v2
        with:
          repository: feaser/microtbx-tests
          submodules: true
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          path: 'third_party'

  build:
    runs-on: ubuntu-latest
    steps:
      - name: Generate build environment
        working-directory: tests/base/LINUX_PC_GCC/build
        run: cmake ..
      - name: Build test application
        working-directory: tests/base/LINUX_PC_GCC/build
        run: make

  run:
    runs-on: ubuntu-latest
    steps:
      - name: Run test application
        working-directory: tests/base/LINUX_PC_GCC/build
        run: microtbx_tests
